<html>
<head>
<title>P6Spy Documentation</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="5" color="#000066"><b><a href="http://www.p6spy.com">P6Spy 
  Software</a></b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="toc"></a>Table 
  of Contents</b></font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#license">License 
    agreement</a></font></li>
  <li><a href="#release"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Release 
    notes </font></a></li>
  <li><a href="#install"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">General 
    installation &amp; upgrade instructions</font></a></li>
  <li><a href="#m_property"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">General 
    property file settings</font></a> </li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#log">Log 
    file format</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#p6log">P6Log</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#p6outage">P6Outage</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#jsp">The 
    JSP application</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#jboss">Installation 
    under JBoss</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#orion">Installation 
    under Orion</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#tomcat">Installation 
    under Tomcat</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#jonas">Installation 
    under JOnAS</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#wlportal">Installation 
    under WebLogic Portal 4.0</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#wlserver">Installation 
    under WebLogic Server 6.1</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#weblogic">Installation 
    under WebLogic 5.1</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#atg">Installation 
    under ATG</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#iplanet">Installation 
    under iPlanet</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#issues">Known 
    issues</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#trouble">Troubleshooting</a></font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><a href="#FAQ">FAQ</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#build">Building 
    the Source</a> </font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="license"></a>License 
  Agreement</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">/*<br>
  *<br>
  * ====================================================================<br>
  * <br>
  * The P6Spy Software License, Version 1.1<br>
  *<br>
  * This license is derived and fully compatible with the Apache Software<br>
  * license, see http://www.apache.org/LICENSE.txt<br>
  *<br>
  * Copyright (c) 2001-2002 Andy Martin, Ph.D. and Jeff Goke<br>
  * All rights reserved. <br>
  *<br>
  * Redistribution and use in source and binary forms, with or without<br>
  * modification, are permitted provided that the following conditions<br>
  * are met:<br>
  *<br>
  * 1. Redistributions of source code must retain the above copyright<br>
  * notice, this list of conditions and the following disclaimer. <br>
  *<br>
  * 2. Redistributions in binary form must reproduce the above copyright<br>
  * notice, this list of conditions and the following disclaimer in<br>
  * the documentation and/or other materials provided with the<br>
  * distribution.<br>
  *<br>
  * 3. The end-user documentation included with the redistribution, if<br>
  * any, must include the following acknowledgment: <br>
  * &quot;The original concept and code base for P6Spy was conceived<br>
  * and developed by Andy Martin, Ph.D. who generously contributed<br>
  * the first complete release to the public under this license.<br>
  * This product was due to the pioneering work of Andy<br>
  * that began in December of 1995 developing applications that could<br>
  * seamlessly be deployed with minimal effort but with dramatic results.<br>
  * This code is maintained and extended by Jeff Goke and with the ideas<br>
  * and contributions of other P6Spy contributors.<br>
  * (http://www.p6spy.com)&quot;<br>
  * Alternately, this acknowledgment may appear in the software itself,<br>
  * if and wherever such third-party acknowledgments normally appear.<br>
  *<br>
  * 4. The names &quot;P6Spy&quot;, &quot;Jeff Goke&quot;, and &quot;Andy Martin&quot; 
  must not be used<br>
  * to endorse or promote products derived from this software without<br>
  * prior written permission. For written permission, please contact<br>
  * license@p6spy.com.<br>
  *<br>
  * 5. Products derived from this software may not be called &quot;P6Spy&quot;<br>
  * nor may &quot;P6Spy&quot; appear in their names without prior written<br>
  * permission of Jeff Goke and Andy Martin.<br>
  *<br>
  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED<br>
  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES<br>
  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE<br>
  * DISCLAIMED. IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR<br>
  * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,<br>
  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT<br>
  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF<br>
  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND<br>
  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,<br>
  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT<br>
  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF<br>
  * SUCH DAMAGE.<br>
  */ </font></p>
<p></p>
<p><a name="release"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>Release 
  Notes </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 1.0</b></font></p>
<ul>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Restructured 
    code to inherit from a single core wrapper driver.</font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Introduced concepts 
    of modules and stackable drivers that dynamically load the necessary code 
    into memory at runtime.</font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Broke code into 
    logical modules: P6Log and P6Outage.</font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Refactored large 
    amount of code.</font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Rewrote Junit 
    tests and added more rigorous tests.</font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 0.8</b></font></p>
<ul>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><strong>Peter 
    Laird</strong> contributed an Outage Detection module that reports database 
    outages when database statements do not respond within a given period of time.</font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><strong>Peter 
    Laird</strong> also contributed a JSP application that gives a visual control 
    to P6Spy. The first version can be used to view configuration information 
    about P6Spy and to create a demarcation in the log file.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>Viktor 
    Szathmary</strong> added support for multiple simultaneous databases, a highly 
    requested feature. Currently support is limited to 3 databases, but can easily 
    be expanded.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>Viktor 
    Szathmary</strong> also added the logging of a connection id, and enabled 
    urls to be prefixed with p6spy: to aid in debugging. A common mistake people 
    make when installing is to have the real driver registered elsewhere, this 
    feature avoids that problem. The default is not to require this value, but 
    in the future it may be made mandatory to ease the install process.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Rewrote P6SpyOptions 
    to allow new options to quickly and easily be added.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Additional JUnit 
    tests have been added</font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 0.72</b></font></p>
<ul>
  <li><strong><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Philip 
    Ogren</font></strong><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> 
    contributed the ability to dynamically reload the property file after a specified 
    period of time</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added logging 
    to commit and rollback statements</font></li>
  </ul>
            <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 0.71</b></font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>Philip 
    Ogren</strong> of BEA contributed installation instructions for BEA WebLogic 
    <a href="#wlportal">Portal</a> and <a href="#wlserver">Server</a>.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Jakarta RegEx 
    support (contributed by Philip Ogren)</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Ability to print 
    stack trace of logged statements. This is very useful to understand where 
    a logged query is being executed in the application (contributed by Philip 
    Ogren)</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Simplified table 
    monitoring property file option (contributed by Philip Ogren)</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Updated the 
    RegEx documentation</font></li>
</ul>
            <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 0.7</b></font></p>
<ul>
  <li><strong><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Simon 
    Sadedin</font></strong><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> 
    added timing information to the log files. Now you can better visualize bottleneck 
    queries.</font></li>
  <li><strong><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Simon 
    Sadedin</font></strong><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> 
    added regex support for table filtering, allowing sophisticated custom filtering.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>Michael 
    Sgroi</strong> contributed installation instructions for <a href="#iplanet">iPlanet</a>.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><strong>Richard 
    Delbert</strong> contributed installation instructions for <a href="#weblogic">WebLogic</a>.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added support 
    for callable statements.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added support 
    for batch statements.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added a debug 
    category that provides detailed debug information. By default this is disabled. 
    See the <a href="#trouble">troubleshooting</a> section for more information.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Changed the 
    default log format to include more information.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added test target 
    to ant that works with JUnit to perform some basic tests. Currently using 
    Oracle as the test database.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added ResultSet 
    logging and timing information. By default this is disabled. See the <a href="#log">log</a> 
    section for more information.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Fixed a number 
    of bugs, in particular a bug that was causing an empty spy.log file to be 
    created and never populated.</font></li>
</ul>
            <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 0.6</b></font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Fixed a bug 
    that null connections were not returning null, but rather an empty connection. 
    This was a problem for some applications where the application was expecting 
    a null connection.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added an option 
    to allow the truncation/non-truncation of the log file to be specified within 
    spy.options. </font></li>
</ul>
<p><a name="install"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>General 
  Installation Instructions</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The P6Spy software 
  is very easy to install.&nbsp;&nbsp;There are explicit step-by-step installation 
  instructions for many application servers (see the <a href="#toc">table of contents</a>). 
  If you create instructions for other servers, please send us a copy and we will 
  include them in the documentation. Once the software is installed, P6Spy offers 
  many options to let you tailor the software to your needs. See the property 
  file settings for details.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">For those of you 
  who have been using the closed-source version of p6spy, there is only one significant 
  change. In the previous release the package name was &quot;com.p6.engine.spy.P6SpyDriver&quot; 
  in this release it is &quot;com.p6spy.engine.spy.P6SpyDriver&quot;. Notice &quot;com.p6&quot; 
  has been changed to &quot;com.p6spy&quot;. This means a small adjustment to 
  your configuration file. This should not change again.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put the p6spy.jar 
    file in your classpath.</b> Either copy the p6spy.jar file into your ext direction 
    (if you are using and EJB server it probably has its own ext directory, if 
    you are not, then you probably want to use the JDK ext directory which is 
    JDK_HOME/jre/lib/ext) or add p6spy.jar to your classpath.&nbsp;&nbsp;Remember 
    that if you are adding p6spy.jar to your classpath, you must reference the 
    jar filename directly.&nbsp;&nbsp;In Windows, for example, it might look like: 
    CLASSPATH=c:\p6spy\p6spy.jar.&nbsp;&nbsp;Note that if you are using an EJB 
    server, adding the p6spy.jar file to your classpath may not work.&nbsp;&nbsp;Some 
    EJB servers ignore the classpath and set their own when they start up.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put spy.properties 
    in your classpath.</b> Copy the spy.properties file into a directory listed 
    in your classpath.&nbsp;&nbsp;For example, if your classpath is C:\p6spy\p6spy.jar;c:\java 
    you can copy it to the java directory.&nbsp;&nbsp;Unlike jar files, you do 
    not directly reference your property file in the classpath.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell your 
    application or server to use the P6Spy database driver.</b> Modify your server 
    settings or application settings to tell your application to use P6Spy as 
    your database driver, which is: com.p6spy.engine.spy.P6SpyDriver &nbsp;&nbsp;&nbsp;This 
    does not impact your application, it simply allows P6Spy to read in the database 
    statements before they reach your database driver.&nbsp;&nbsp;Since the P6Spy 
    driver passes through all requests to your real driver, you leave all of the 
    other configuration information, such as the connection address, user, password, 
    etc. the same.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell P6Spy 
    about your real database driver.</b> &nbsp;Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp;&nbsp;For 
    example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Run your 
    application.</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&nbsp;&nbsp;A 
    log file will be generated in the starting directory of your application (you 
    can change this, see the property file section of the documentation).&nbsp;&nbsp;If 
    you can't find the log file, try searching for spy.log</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>View the 
    log file.</b> &nbsp;The log file contains a list of all of the database statements 
    that are executed.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="g_property"></a>General 
  Property File Settings </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Example property 
  file:</b></font></p>
<p>#################################################################<br>
  # P6Spy Options File #<br>
  # See documentation for detailed instructions #<br>
  #################################################################</p>
<p>#################################################################<br>
  # MODULES #<br>
  # #<br>
  # Modules provide the P6Spy functionality. If a module, such #<br>
  # as module_log is commented out, that functionality will not #<br>
  # be available. If it is not commented out (if it is active), #<br>
  # the functionality will be active. #<br>
  # #<br>
  # Values set in Modules cannot be reloaded using the #<br>
  # reloadproperties variable. Once they are loaded, they remain #<br>
  # in memory until the application is restarted. #<br>
  # #<br>
  #################################################################</p>
<p>module_log=com.p6spy.engine.logging.P6LogSpyDriver<br>
  module_outage=com.p6spy.engine.outage.P6OutageSpyDriver</p>
<p>#################################################################<br>
  # REALDRIVER(s) #<br>
  # #<br>
  # In your application server configuration file you replace the #<br>
  # &quot;real driver&quot; name with com.p6spy.engine.P6SpyDriver. This is #<br>
  # where you put the name of your real driver P6Spy can find and #<br>
  # register your real driver to do the database work. #<br>
  # #<br>
  # If your application uses several drivers specify them in #<br>
  # realdriver2, realdriver3. See the documentation for more #<br>
  # details. #<br>
  # #<br>
  # Values set in REALDRIVER(s) cannot be reloaded using the #<br>
  # reloadproperties variable. Once they are loaded, they remain #<br>
  # in memory until the application is restarted. #<br>
  # #<br>
  #################################################################</p>
<p># realdriver = org.gjt.mm.mysql.Driver <br>
  realdriver = oracle.jdbc.driver.OracleDriver<br>
  #specifies another driver to use<br>
  realdriver2=<br>
  #specifies a third driver to use<br>
  realdriver3=</p>
<p>################################################################<br>
  # P6LOG SPECIFIC PROPERTIES #<br>
  ################################################################<br>
  # determines if p6log outputs information<br>
  trace = true</p>
<p>################################################################<br>
  # P6OUTAGE SPECIFIC PROPERTIES #<br>
  ################################################################<br>
  # Outage Detection<br>
  #<br>
  # This feature detects long-running statements that may be indicative of<br>
  # a database outage problem. If this feature is turned on, it will log any<br>
  # statement that surpasses the configurable time boundary during its execution.<br>
  # When this feature is enabled, no other statements are logged except the long<br>
  # running statements. The interval property is the boundary time set in seconds.<br>
  # For example, if this is set to 2, then any statement requiring at least 2 
  <br>
  # seconds will be logged. Note that the same statement will continue to be logged<br>
  # for as long as it executes. So if the interval is set to 2, and the query 
  takes<br>
  # 11 seconds, it will be logged 5 times (at the 2, 4, 6, 8, 10 second intervals).<br>
  #<br>
  # outagedetection=true|false<br>
  # outagedetectioninterval=integer time (seconds)<br>
  #<br>
  outagedetection=false<br>
  outagedetectioninterval=</p>
<p><br>
  ################################################################<br>
  # COMMON PROPERTIES #<br>
  ################################################################</p>
<p># comma separated list of tables to include<br>
  include =<br>
  # comma separated list of tables to exclude<br>
  exclude =</p>
<p># sql expression to evaluate if using regex<br>
  sqlexpression = </p>
<p># filter what is logged<br>
  filter=false </p>
<p># turn on tracing<br>
  autoflush = true<br>
  # name of logfile if trace is on, use &quot;stdout&quot; for standard output.<br>
  logfile = spy.log<br>
  # append to the p6spy log file. if this is set to false the<br>
  # log file is truncated every time.<br>
  append=true</p>
<p># sets the date format using Java's SimpleDateFormat routine<br>
  dateformat=</p>
<p>#list of categories to explicitly include<br>
  includecategories=</p>
<p>#list of categories to exclude: info, batch, debug, statement,<br>
  #commit, rollback and result are valid values<br>
  excludecategories=info,debug,result,batch</p>
<p>#allows you to use a regex engine or your own matching engine to determine 
  <br>
  #which statements to log<br>
  #<br>
  #stringmatcher=com.p6spy.engine.common.GnuRegexMatcher<br>
  #stringmatcher=com.p6spy.engine.common.JakartaRegexMatcher<br>
  stringmatcher=</p>
<p># prints a stack trace for every statement logged<br>
  stacktrace=false<br>
  # if stacktrace=true, specifies the stack trace to print<br>
  stacktraceclass=</p>
<p># determines if property file should be reloaded<br>
  reloadproperties=false<br>
  # determines how often should be reloaded in seconds<br>
  reloadpropertiesinterval=60<br>
  #if=true then url must be prefixed with p6spy:<br>
  useprefix=false</p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>module_xxx</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">module_xxx is the 
  name of a particular module to be loaded at system startup. A module contains 
  a group of functionality. If a module line is not commented out, it is loaded 
  into memory, and will remain in memory until the application is restarted. Modules 
  can not be changed by using the reloadproperties function. If all modules are 
  commented out, then nothing except the real database driver is loaded.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Currently the following 
  modules are supported:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">module_log=com.p6spy.engine.logging.P6LogSpyDriver<br>
  module_outage=com.p6spy.engine.outage.P6OutageSpyDriver</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">module_log is required 
  for the logging functionality, see P6Log.<br>
  module_outage is required for the outage functionality, see P6Outage.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>realdriver</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">realdriver is where 
  you specify the real database driver that you use.&nbsp;&nbsp;P6Spy wraps around 
  your existing driver, intercepts the incoming database requests, and outputs 
  them to a log file.&nbsp;&nbsp;To achieve this without requiring any code changes, 
  the P6Spy driver is listed with your application as the primary driver.&nbsp;&nbsp;P6Spy 
  then intercepts and logs the requests, and passes the request to the realdriver 
  where it is processed as usual.&nbsp;&nbsp;Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">realdriver = oracle.jdbc.driver.OracleDriver</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>realdriver2, 
  realdriver3 </b></font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">if you have multiple 
  database drivers then you need a way to specify these drivers. This is where 
  realdriver2 and realdriver3 are used. To monitor the first database, you modified 
  your server settings or application settings to tell your application to use 
  P6Spy as your database driver, which is: com.p6spy.engine.spy.P6SpyDriver &nbsp;&nbsp;&nbsp;For 
  the second database, specify the driver as com.p6spy.engine.spy.P6SpyDriver2 
  and set realdriver2 to the real driver. For the third database, specify the 
  driver as com.p6spy.engine.spy.P6SpyDriver3 and set realdriver3 to the real 
  driver.</font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Note that if you 
  are using the same database driver with multiple connection strings, you should 
  use the same driver. E.g. say you have two MySQL databses: mydb and testdb. 
  You want to connect to both databases and log their activity. You have two datasources 
  defined. You should specify com.p6spy.engine.spy.P6SpyDriver as the database 
  driver for both of these and you should set the realdriver= the real mysql JDBC 
  driver name. realdriver2, realdriver3 are only intended for use when you are 
  connecting with two different drivers, for example Oracle versus MySQL.</font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">To understand why 
  this is the case, remember that Java uses the DriverManager to register all 
  of the drivers. As each class is loaded, it registers itself with the DriverManager. 
  When a connection is requested for a specific URL, the driver manager goes through 
  the list of registered drivers and asks each in turn if it will handle that 
  url (via the acceptURL method). The first driver that says yes becomes the driver 
  that is used. Since an Oracle driver can handle any valid Oracle URL, registering 
  the driver twice will just cause only one of the drivers (the first one that 
  was registered) to handle the request. The second will be ignored. Therefore, 
  if you specify the same driver in realdriver and realdriver2 you won't have 
  any problems, but you will have the same driver registered multiple times.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>filter, include, 
  exclude </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">P6Spy lets you 
  monitor specific tables or specific statement types.&nbsp;&nbsp;By setting filter=true 
  P6Spy will perform string matching on each statement to determine if it should 
  be written to the log file.&nbsp;&nbsp;include accepts a comma separated list 
  of expressions which are required to be appear in a statement before it can 
  appear in the log, exclude accepts a comma separated list to exclude. By default 
  string matching is performed using a basic substring match. However Regex matching 
  can also be used (see Custom Filtering below). Note that exclusion overrides 
  inclusion, so that a statement matching both an include string and an exclude 
  string will be excluded. </font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">example (capture 
  all select statements except the orders table):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = true<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># comma separated 
  list of tables to include<br>
  include = select<br>
  # comma separated list of tables to exclude<br>
  exclude = orders</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">example (only captures 
  statements against order,order_details,price, and price_history):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = true<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># comma separated 
  list of tables to include<br>
  include = order,order_details,price,price_history<br>
  # comma separated list of tables to exclude<br>
  exclude =</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">example (captures 
  all statements except statements against the order table):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = false<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># comma separated 
  list of tables to include<br>
  include = <br>
  # comma separated list of tables to exclude<br>
  exclude = order</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>filter, sqlexpression</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If you plan on 
  using a regex engine, a simple alternative to exclude and include is to use 
  sqlexpression. It works like this:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = true<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">sqlexpression 
  = your expression</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If your expression 
  matches the SQL string, it is logged, if not, it is not. Note, if you use sqlexpression, 
  any values set in include and exclude are ignored.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>stringmatcher 
  (Custom Filtering)</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> If you want to 
  apply more intelligence to what is logged or not logged by P6Spy you can specify 
  a custom matching engine. P6Spy comes with support for several regex engines, 
  though it is trivial to introduce another engine by implementing the StringMatcher 
  interface. If a stringmatcher engine is specified, P6Spy will pass each statement 
  to the class specified to determine if that statement should be logged.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Using GNU RegEx<br>
  </i></font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">P6Spy 
  comes with support for a regular expression matcher based on the GNU Regex library. 
  To use this, for example, you would specify:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># Use GNU Regex 
  Matching for Filtering<br>
  stringmatcher =com.p6spy.engine.common.GnuRegexMatcher<br>
  <br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Note that 
  in order to do this you must <a href="http://www.cacas.org/java/gnu/regexp/">download</a> 
  the GNU Java regex library and add it to your classpath so that P6Spy can find 
  it. <br>
  <br>
  <i>Using Jakarta RegEx<br>
  </i>P6Spy also includes support for the Apache Jakarta Regex library. To use 
  this, you would specify:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># Use Apache Jakarta 
  Regex Matching for Filtering<br>
  stringmatcher =com.p6spy.engine.common.JakartaRegexMatcher<br>
  <br>
  Note that in order to do this you must <a href="http://jakarta.apache.org/builds/jakarta-regexp/">download</a> 
  the Apache Jarkarta regex library and add it to your classpath so that P6Spy 
  can find it.</font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> 
  </font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>autoflush</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">For standard development 
  this value should be set to true. &nbsp;When set to true every time a statement 
  is intercepted it is immediately written to the log file.&nbsp;&nbsp;In some 
  cases, however, instant feedback on every statement is not a requirement, and 
  the system will perform slightly faster with this value set to false</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">autoflush = true<br>
  <b><br>
  </b> </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>logfile</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Specifies the name 
  of the file to generate.&nbsp;&nbsp;Use &quot;stdout&quot; for standard output. 
  Note, if you are in Windows and are specifying a pathname, make sure to use 
  forward slashes (e.g. c:/mylog/spy.log)</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">logfile = spy.log<br>
  <b><br>
  </b> </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>append</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Setting append=true 
  causes p6spy to continue to append to the logfile, if it exists. Setting append=false 
  causes the logfile to be truncated each time p6spy is restarted (typically when 
  your application or application server is restarted).</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>excludecategories</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The log includes 
  category information that describes the type of statement. This property excludes 
  the listed categories. Valid options include:</font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>info</strong> 
    includes driver startup information and property file information </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>debug 
    </strong>is only intended for use when you cannot get your driver to work 
    properly, it dumps out everything</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>statement 
    </strong> includes Statements, PreparedStatements, and CallableStatements<strong> 
    </strong></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>batch</strong> 
    addBatch() calls</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>commit</strong> 
    commit() calls</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>rollback</strong> 
    rollaback() calls</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><strong>result</strong> 
    are statements generated by ResultSet</font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Enter a comma separated 
  list of categories to exclude from your log file. See filter,include,exclude 
  for more details on how this process works.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>includecategories</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The log includes 
  category information that describes the type of statement. This property is 
  a comma separated list of categories to include. See excludecategories for a 
  valid list of categories.</font></p>
            <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>dateformat</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Setting a value 
  for dateformat changes the date format value printed in the log file. No value 
  prints the current time in milliseconds, a useful feature for parsing the log. 
  The date format engine is Java's SimpleDateFormat class. See the SimpleDateFormat 
  class in the JavaDocs for information on setting this value. Example value: 
  dateformat=MM-dd-yy HH:mm:ss:SS</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>stacktrace</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If stack trace 
  is set, prints out the stack trace for each sql statement logged.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>stacktraceclass</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Limits the stack 
  traces printed out to those that contain this value. E.g. specifying stacktraceclass=com.mycompany.myclass 
  would limit the printing of stack traces to the specified class value. The stack 
  trace is converted to a String and string.indexOf(stacktraceclass) is performed.</font><br>
  <b><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><br>
  </font></b> <font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>reloadproperties 
  and reloadpropertiesinterval</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If reloadproperties 
  is set to true, then the property file is reloaded every n seconds, where n 
  is defined by the value set by reloadpropertiesinterval. For example, if reloadproperties=true 
  and reloadpropertiesinterval=10 then the system checks the File.lastModified() 
  property of the property file every 10 seconds, and if the file has been modified, 
  then it will be reloaded.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Warning! If you 
  have append=true the log will be suddenly truncated if you change your properties. 
  This is because using reloadproperties is intended to be the equivalent of restarting 
  your application server, and in the case of an application server restart your 
  file would be truncated.</font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Limitations: reloadproperties 
  will not reload any driver information (such as realdriver, realdriver2, and 
  realdriver3) and will not change the modules that are in memory.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>useprefix</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">When set to true 
  requires you to prefix your URLs with p6spy:. The default is false, but may 
  become true in a future release. This helps avoid a common pital when installing 
  p6spy, that your real driver is registered elsewhere and because the URLs are 
  the same, the system does not know which driver to use.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b></b></font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Command 
  Line Options </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Every parameter 
  specified in the property file can be set and override at the command line using 
  the Java -D flag.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">java -Dp6logfile=my.log 
  -Dp6trace=true</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">In addition, you 
  can set the default directory to look for spy.properties:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">java -Dp6.home=c:\orion\lib</font></p>
<p><a name="log"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>Log 
  File Format</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The log file format 
  of spy.log is as follows:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">current time|execution 
  time|category|statement SQL String|effective SQL string</font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Current time</i>. 
    The current time is obtained through System.getCurrentTimeMillis() and represents 
    the number of milliseconds that have passed since January 1, 1970 00:00:00.000 
    GMT. See the J2SE documentation for further details. This can be changed to 
    a different format using the dateformat property described later in this section.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Execution 
    time</i>. The time it took for that method to execute. It is important to 
    note this is not the total cost for the SQL statement, but rather the time 
    it takes to execute a particular method. For example, a statement SELECT * 
    FROM MYTABLE WHERE THISCOL = ? might be executed as a prepared statement, 
    in which the .execute() function will be measured. This is recorded as the 
    &quot;statement&quot; category. Further, as you call .next() on the ResultSet, 
    each .next() call is recorded in the result category.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Category</i>. 
    Currently there are three categories: debug (debug statements related to p6spy), 
    statement (statement, preparedStatement, and CallableStatement) and result 
    (ResultSet). You can manage your log by including and excluding categories, 
    which is described below. </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Statement 
    SQL String</i>. This is the SQL string passed to the statement object. If 
    it is a prepared statement, it will be the prepared statement prior to the 
    parameters being set, to see the complete statement see <i>Effective SQL String</i>.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Effective 
    SQL String</i>. If you are not using a prepared statement, this will be empty. 
    Otherwise it will fill in the values of the Prepared Statement so you can 
    see the effective SQL statement that is passed to the Database. Of course 
    the Database still sees the Prepared Statement, but this string allows a convenient 
    way to see the actual values being based to the Database.</font></li>
</ul>
            
<p><a name="p6log"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>P6Log</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The P6Log module 
  is enabled by default. This module logs all database statements. Comment out 
  the following line to disable the module (the line must be uncommented for the 
  module to function):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">module_log=com.p6spy.engine.logging.P6LogSpyDriver</font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">The following are 
  the module specific properties:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>trace</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Trace is a convenience 
  toggle that lets you turn on and off the logging.&nbsp;&nbsp;When trace is set 
  to true, P6Spy writes the the log file whenever an appropriate database request 
  is intercepted. &nbsp;When trace is set to false, P6Spy never writes to the 
  log file.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># turn</font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">on 
  tracing<br>
  trace = true</font></p>
<p><a name="p6outage"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>P6Outage</b></font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">The P6Outage module 
  is disabled by default. This module reports a possible outage whenever database 
  statements take longer than a specified interval to return. To enable P6Outage, 
  uncomment the following line (when it is commented out, it is not available):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">module_outage=com.p6spy.engine.outage.P6OutageSpyDriver</font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">The following are 
  the module specific properties:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>outagedetection</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"></font> <font size="2" face="Verdana, Arial, Helvetica, sans-serif">This 
  feature detects long-running statements that may be indicative of a database 
  outage problem. If this feature is turned on, it will log any statement that 
  surpasses the configurable time boundary during its execution. When this feature 
  is enabled, no other statements are logged except the long running statements.</font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><strong>outagedetectioninterval</strong></font></p>
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">The interval property 
  is the boundary time set in seconds. For example, if this is set to 2, then 
  any statement requiring at least 2 seconds will be logged. Note that the same 
  statement will continue to be logged for as long as it executes. So if the interval 
  is set to 2, and the query takes 11 seconds, it will be logged 5 times (at the 
  2, 4, 6, 8, 10 second intervals).</font> </p>
<p><a name="jsp"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>The 
  JSP Application</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">P6Spy now includes 
  a JSP application that can be used to view configuration information about P6Spy 
  and to create a demarcation in the log file.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The easiest way 
  to use the JSP application is to copy p6spy.war into the deployment directory 
  of your application server. (For example, in JBoss this might be C:\JBoss-2.4.4_Tomcat-4.0.1\jboss\deploy). 
  Once the .war file is deployed, you can access the application by using the 
  URL http://machine:port/p6spy</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">For example, if 
  you are running the application on your own machine, and using Tomcat as the 
  servlet engine, you would go to: http://localhost:8080/p6spy</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="jboss"></a>JBoss 
  Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with various Jboss versions ranging from Jboss 2.2.2-2.4.4 
  with Tomcat 3.2.2-4.0.1 integration.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put the p6spy.jar 
    file in your ext directory.</b> For example: C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\lib\ext</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put spy.properties 
    in your db directory (which is part of the JBoss classpath).</b> For example: 
    C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\db</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell JBoss 
    to use the P6Spy driver. </b>&nbsp;Modify the jboss.jcml file to use the P6 
    driver.&nbsp;&nbsp;Make sure to modify the correct file. In the case of the 
    integrated tomcat solution, you should modify the jboss.jcml file in the Tomcat 
    conf directory. You should remove your existing driver from the drivers attribute 
    and replace that driver with the P6Spy driver. This looks like:</font> </li>
  <blockquote> 
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;mbean code=&quot;org.jboss.jdbc.JdbcProvider&quot; 
      name=&quot;DefaultDomain:service=JdbcProvider&quot;&gt;<br>
      &lt;attribute name=&quot;Drivers&quot;&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/attribute&gt;<br>
      &lt;/mbean&gt;</font></p>
  </blockquote>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell P6Spy 
    about your real database driver.</b> &nbsp;Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp;&nbsp;For 
    example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Installation 
    is complete.&nbsp;&nbsp;</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">There 
    is nothing else to change. You leave your connect string, username, password 
    and other attributes exactly as they were before you installed P6Spy, the 
    P6Spy driver does all of the work required to pass this information along 
    to your real database driver.</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Run your 
    application.</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&nbsp;&nbsp;A 
    spy.log file will be generated in the bin directory of the JBoss server such 
    as: C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\bin </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>View the 
    log file.</b> &nbsp;The log file contains a list of all of the database statements 
    that are executed.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="orion"></a>Orion 
  Installation</b></font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put p6spy.jar 
    and spy.properties in your [orion-home]\lib directory.</b> For example: c:\orion\lib</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell Orion 
    to use the P6Spy driver. </b>&nbsp;Modify [orion-home]\config\data-sources.xml 
    to use the P6 driver.&nbsp;&nbsp;In the data-sources.xml file change connection-driver 
    to specify the p6spy driver instead of the database driver you are using. 
    For example:</font> </li>
  <blockquote> 
    <p> <font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;data-source<br>
      class=&quot;com.evermind.sql.DriverManagerDataSource&quot;<br>
      name=&quot;Hypersonic&quot;<br>
      location=&quot;jdbc/HypersonicCoreDS&quot;<br>
      xa-location=&quot;jdbc/xa/HypersonicXADS&quot;<br>
      ejb-location=&quot;jdbc/HypersonicDS&quot;<br>
      connection-driver=&quot;com.p6spy.engine.spy.P6SpyDriver&quot;<br>
      username=&quot;sa&quot;<br>
      password=&quot;&quot;<br>
      url=&quot;jdbc:HypersonicSQL:./database/defaultdb&quot;<br>
      inactivity-timeout=&quot;30&quot;<br>
      /&gt;</font></p>
  </blockquote>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell P6Spy 
    about your real database driver.</b> &nbsp;Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp;&nbsp;This 
    is the value that was previously specified in connection-driver before you 
    changed it in step 3. For example, if you were using Hypersonic (the default 
    database) this would be: realdriver = org.hsql.jdbcDriver</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Installation 
    is complete.&nbsp;&nbsp;</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">There 
    is nothing else to change. You leave your connect string, username, password 
    and other attributes exactly as they were before you installed P6Spy, the 
    P6Spy driver does all of the work required to pass this information along 
    to your real database driver.</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Run your 
    application.</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&nbsp;&nbsp;In 
    the example installation, Orion will not be able to find spy.properties because 
    of the classpath that Orion uses. The easiest way to overcome this is to use 
    the -D option to tell Orion where the property file resides. For example, 
    run Orion using java -Dp6.home=c:\orion\orion\lib -jar orion.jar<br>
    <br>
    A spy.log file will be generated in the [orion-home] directory. If for some 
    reason the file does not appear in that directory, search for spy.log on your 
    drive. You can change the location of this file by specifying a location using 
    the property file (see <a href="#property">Property File Settings</a>).<br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>View the 
    log file.</b> &nbsp;The log file contains a list of all of the database statements 
    that are executed.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="tomcat"></a>Tomcat 
  Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with Tomcat 3.x.&nbsp;&nbsp;Please note that since you typically 
  write or otherwise obtain your own connection pool when using Tomcat, these 
  instructions will differ by application.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties. Copy them to the lib\ directory of 
    your web application. For example: C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\lib</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell your 
    Tomcat application to use P6Spy as the database driver. </b> Tomcat applications 
    obtain their JDBC connection in a variety of ways. Most applications have 
    the database driver name externalized as a configuration parameter. For example, 
    in your web.xml file (C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\web.xml) 
    you may have something like this:<br>
    <br>
    &lt;init-param&gt;&lt;param-name&gt;databaseDriver&lt;/param-name&gt;&lt;param-value&gt;org.gjt.mm.mysql.Driver&lt;/param-value&gt;&lt;/init-param&gt;<br>
    <br>
    In this case the &quot;databaseDriver&quot; parameter has a value of &quot;org.gjt.mm.mysql.Driver&quot;, 
    which is the MySQL driver. Wherever this configuration information is stored, 
    you need to change the driver name (&quot;org.gjt.mm.mysql.Driver&quot; in 
    our example) to com.p6spy.engine.spy.P6SpyDriver such as:<br>
    <br>
    &lt;init-param&gt;&lt;param-name&gt;databaseDriver&lt;/param-name&gt;&lt;param-value&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/param-value&gt;&lt;/init-param&gt;<br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Enable Tomcat 
    to find spy.properties. </b>While all of the .jar files in your webapps lib 
    directory are, by default, included in Tomcat's classpath, the lib directory 
    itself is not, which means Tomcat will not be able to find your spy.properties 
    file, which will cause an error to occur. All this means is that you have 
    to include spy.properties in the Tomcat classpath. The simplest way to do 
    this is to use the TOMCAT_OPTS environment variable to specify the location 
    of the spy.properties file. For example:<br>
    <br>
    SET TOMCAT_OPTS=-Dp6.home=C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\lib<br>
    <br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change the 
    spy.properties file to reference your database. </b>You must tell P6Spy about 
    your real database driver. The realdriver property is, by default, set to 
    Oracle, such as: realdriver = oracle.jdbc.driver.OracleDriver, change this 
    to reflect your database. In our previous example, where we were using MySQL, 
    this would be changed to: realdriver = org.gjt.mm.mysql.Driver</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Run your 
    application and view the logs. </b>By default the spy.log file is written 
    to the place you start Tomcat, such as C:\jakarta-tomcat-3.2.1\bin - you can 
    change the location of this file by specifying a location using the property 
    file (see <a href="#property">Property File Settings</a>).</font></li>
</ol>
<p><a name="jonas"></a><b><font face="Verdana, Arial, Helvetica, sans-serif" size="+1">JOnAS 
  Installation</font></b> 
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Contributed 
  by Franois Exertier, JOnAS Opensource EJB Server team)</i> </font>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">These instructions 
  have been tested with JOnAS 2.3.x. </font>
<ol>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp; This contains two 
    files: p6spy.jar and spy.properties</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Put the 
    p6spy.jar file in the classpath of the JOnAS EJB server.</b> For example, 
    if p6spy.jar is in the /opt/Provider6 directory, you may add /opt/Provider6/p6psy.jar 
    to the XTRA_CLASSPATH environment variable (or directly edit the config_env 
    script)</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Put spy.properties 
    in a directory which is part of your classpath.</b> The best may be to put 
    it in the same directory as your jndi.properties file</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Tell JOnAS 
    to use the P6Spy database driver.&nbsp;</b> Database access configuration 
    within JOnAS is described in a DataSource property file, e.g. Oracle1.properties 
    (see the JOnAS Bean Programmer's Guide for more details). Modify the &lt;datasource>.properties 
    file by replacing the database driver classname by the P6Psy database driver 
    class name in the datasource.classname property. For example the Oracle1.properties 
    file delivered with JOnAS should be updated by replacing oracle.jdbc.driver.OracleDriver 
    by com.p6spy.engine.spy.P6SpyDriver, it then looks like</font></li>
  <blockquote><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.name&nbsp;&nbsp; 
    jdbc_1</font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.description&nbsp; 
    "Standard jdbc driver for Oracle"</font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.url&nbsp;&nbsp; 
    jdbc:oracle:thin:scott/tiger@maltes:1521:ORA1</font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.classname 
    <b>com.p6spy.engine.spy.P6SpyDriver</b></font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">...</font></blockquote>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Tell P6Spy 
    about your real database driver.</b>&nbsp; Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp; 
    In our example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Installation 
    is complete.&nbsp; </b>There is nothing else to change. You leave your other 
    datasource properties, e.g. name, url, username, password and so on exactly 
    as they were before you installed P6Spy, the P6Spy driver does all of the 
    work required to pass this information along to your real database driver</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Run your 
    application.</b>&nbsp; Run EJBServer. A spy.log file will be generated in 
    the launching directory</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>View the 
    log file.</b>&nbsp; The log file contains a list of all of the database statements 
    that are executed. You can change the location of this file and the nature 
    of its content by using the spy property file (see <a href="#property">Property 
    File Settings</a>)</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="wlportal"></a>WebLogic 
  Portal 4.0 Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif"><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Contributed 
  by Philip Ogren, BEA)</i></font></font> 
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with WebLogic Server 6.1 (Service Pack 2) with WebLogic Portal 
  4.0 (Service Pack 1) running on Windows using:</font><font face="Verdana, Arial, Helvetica, sans-serif"><font size="2"> 
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"></font><font size="2"> 
  </font></font>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">WebLogic jDriver 
    for Oracle </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Oracle thin 
    driver for 8.1.7 </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">WebLogic jDriver 
    for SQL Server </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Sybase jConnect-5_2 
    driver. </font>
</ul>
<font face="Verdana, Arial, Helvetica, sans-serif" size="2">The default Stockportal 
('Avitek') application is used in this example. <b>Cloudscape</b> does <b>not</b> 
work with P6Spy and WebLogic Portal. (Note, Cloudscape <b>does</b><i> </i>work 
with P6Spy when using the J2EE reference implementation server - the following 
suggestion [not yet tested] was submitted by Adrian Fletcher: &quot;I may be wrong 
but I suspect the problem with Cloudscape and Weblogic is that both drivers end 
up registered against the same URL. I seem to remember that the best trick for 
avoiding this is mangling the URL. If you instruct users to prepend &quot;p6spy:&quot; 
to their url and then remove it in your wrapper, it should work in more cases.&quot; 
You can do this with the useprefix option. If anyone has an opportunity to validate 
this, please drop me a line with updated information.)</font> 
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file to a temporary directory. 
    The jar file contains two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Copy p6spy.jar 
    to <code>&lt;bea-home&gt;\wlportal4.0\lib\ext</code></b>. </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Modify set-environment.bat.</b> 
    Open <code>&lt;bea-home&gt;\wlportal4.0\bin\win32\set-environment.bat</code> 
    for edit. <br>
    Add <code>;%P13N_DIR%\lib\ext\p6spy.jar</code> to <code>EXT_CLASSPATH</code> 
    near the bottom of the file. Be sure there are no trailing spaces on the end 
    of this line. </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Copy spy.properties 
    to <code>&lt;bea-home&gt;\wlportal4.0\config\portalDomain</code></b> or to 
    your application's domain directory. </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Open spy.properties 
    for edit.</b> Set <code>realdriver=weblogic.jdbc.oci.Driver</code> - or to 
    the driver you are using. <b>P6Spy does not work with Cloudscape! </b> </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Open <code>&lt;bea-home&gt;\wlportal4.0\config\portalDomain\startPortal.bat</code> 
    for edit. </b> Add <code>;%P13N_DIR%\config\portalDomain</code> to the classpath 
    near the bottom of the file. This puts spy.properties in the classpath. Be 
    sure there are no trailing spaces on the end of this line. </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell WebLogic 
    Portal to use the P6Spy driver. </b>&nbsp; This can be done through the Administration 
    Console or by modifying <code>&lt;bea-home&gt;\wlportal4.0\config\portalDomain\config.xml</code>. 
    If using the Administration Console, start WebLogic Portal using <code>&lt;bea-home&gt;\wlportal4.0\config\portalDomain\startPortal.bat</code>. 
    Start the Administration Console tool by navigating to <code>http://&lt;your-host&gt;:7501/console</code>. 
    Navigate to the '<code>&lt;your-domain&gt;-&gt;Services-&gt;JDBC-&gt;Connection 
    Pools</code>' node and set the Driver Classname for each Connection Pool to 
    <b><code>com.p6spy.engine.spy.P6SpyDriver</code></b>. If a RDBMS Security 
    Realm is being used, this should also be monitored with P6Spy. Using the Administration 
    Console, navigate to the <code>&lt;your-domain&gt;-&gtSecurity-&gtRealms</code> 
    node. Click on the security realm under this node and observe the configuration 
    information on the right hand side. Click on the 'Database' tab and set the 
    'Driver' parameter to <b><code>com.p6spy.engine.spy.P6SpyDriver</code></b>. 
    In this example, modifications to the 'commercePool', 'dataSyncPool' and 'wlcsRealm' 
    should be made. </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Shut down 
    WebLogic Portal</b> using the Administration Console. This can be accomplished 
    by right clicking on the '<code>&lt;your-domain&gt;-&gt;Servers-&gt;&lt;your-server&gt;</code>' 
    node and selecting '<code>Stop this Server</code>' in the popup menu. </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Start WebLogic 
    Portal</b> with the script <code>&lt;bea-home&gt;\wlportal4.0\config\portalDomain\startPortal.bat</code>. 
    </font>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Observe log 
    messages</b> in the file specified by the <code>logfile</code> property set 
    in <code>spy.properties</code>. The default location is <code>&lt;bea-home&gt;\wlportal4.0</code>. 
    </font>
</ol>

 
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="wlserver"></a> 
  WebLogic Server 6.1 Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Contributed 
  by Philip Ogren, BEA)</i> </font> 
<p><font size="2" face="Verdana, Arial, Helvetica, sans-serif">The instructions 
  for installing P6Spy with WebLogic Server differ only slightly from the instructions 
  for installation with WebLogic Portal. </font>
<ol>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file to a temporary directory. 
    The jar file contains two files: p6spy.jar and spy.properties</font></li>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Copy p6spy.jar 
    to <code>&lt;bea-home&gt;\wlserver6.1\lib\ext</code></b>. </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Copy spy.properties 
    to <code>&lt;bea-home&gt;\wlserver6.1\config\&lt;your-domain&gt; </code></b>. 
    </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Open spy.properties 
    for edit.</b> Set <code>realdriver=weblogic.jdbc.oci.Driver</code> - or to 
    the driver you are using. <b>P6Spy does not work with Cloudscape! </b> </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Open <code>&lt;bea-home&gt;\wlserver6.1\config\&lt;your-domain&gt;\startWebLogic.cmd</code> 
    for edit. </b> Add <code>;.\ext\p6spy.jar;.\config\&lt;your-domain&gt;</code> 
    to the classpath near the bottom of the file. This puts p6spy.jar and spy.properties 
    in the classpath. Be sure there are no trailing spaces on the end of this 
    line. </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Tell WebLogic 
    Server to use the P6Spy driver. </b>&nbsp; This can be done through the Administration 
    Console or by modifying <code>&lt;bea-home&gt;\wlserver6.1\config\&lt;your-domain&gt;\config.xml</code>. 
    If using the Administration Console, start WebLogic Portal using <code>&lt;bea-home&gt;\wlportal4.0\config\portalDomain\startPortal.bat</code>. 
    Start the Administration Console tool by navigating to <code>http://&lt;your-host&gt;:7501/console</code>. 
    Navigate to the '<code>&lt;your-domain&gt;-&gt;Services-&gt;JDBC-&gt;Connection 
    Pools</code>' node and set the Driver Classname for each Connection Pool to 
    <b><code>com.p6spy.engine.spy.P6SpyDriver</code></b>. If a RDBMS Security 
    Realm is being used, this should also be monitored with P6Spy. Using the Administration 
    Console, navigate to the <code>&lt;your-domain&gt;-&gtSecurity-&gtRealms</code> 
    node. Click on the security realm under this node and observe the configuration 
    information on the right hand side. Click on the 'Database' tab and set the 
    'Driver' parameter to <b><code>com.p6spy.engine.spy.P6SpyDriver</code></b>. 
    </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Shut down 
    WebLogic Server</b> using the Administration Console. This can be accomplished 
    by right clicking on the '<code>&lt;your-domain&gt;-&gt;Servers-&gt;&lt;your-server&gt;</code>' 
    node and selecting '<code>Stop this Server</code>' in the popup menu. </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Start WebLogic 
    Server</b> with the script <code>&lt;bea-home&gt;\wlserver6.1\config\&lt;your-domain&gt;\startWebLogic.cmd</code>. 
    </font>
  <li><font size="2" face="Verdana, Arial, Helvetica, sans-serif"><b>Observe log 
    messages</b> in the file specified by the <code>logfile</code> property set 
    in <code>spy.properties</code>. The default location is <code>&lt;bea-home&gt;\wlserver6.1. </code>
    </font>
</ol>

<p><a name="weblogic"></a><b><font face="Verdana, Arial, Helvetica, sans-serif" size="+1">WebLogic 
  5.1 Instructions </font></b> </p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Posted by 
  Richard Delbert on April 10, 2002 on TheServerSide.com)</i> </font> 
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">These instructions 
  have been tested with WebLogic 5.1</font>
<ol>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp; This contains two 
    files: p6spy.jar and spy.properties</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Edit startWeblogic.sh, 
    put the p6spy.jar file in the JAVA_CLASSPATH.</b></font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Edit startWeblogic.sh, 
    put spy.properties in the JAVA_CLASSPATH.</b></font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">Edit weblogic.properties 
    (connection pool). </font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"> 
    Replace the JDBC class driver with com.p6spy.engine.spy.P6SpyDriver.</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Tell P6Spy 
    about your real database driver.</b>&nbsp; Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp; 
    In our example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Installation 
    is complete.</b></font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Run your 
    application.</b>&nbsp; A spy.log file will be created in the weblogic home 
    directory.</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>View the 
    log file.</b>&nbsp; The log file contains a list of all of the database statements 
    that are executed. You can change the location of this file and the nature 
    of its content by using the spy property file (see <a href="#property">Property 
    File Settings</a>)</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="atg"></a>ATG 
  Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with ATG Dynamo 5.1.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties. Copy them to a directory. For this 
    example, we will copy both files to c:\p6spy</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Start the 
    ATG Dynamo server.</b> Start the ATG application server and your database.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change the 
    ATG Dynamo server to include both files in the classpath.</b></font></li>
  <ul>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">run the admin 
      tool (in this example we will assume you are running ATG on your own machine, 
      so we will use localhost as the machine name), go to http://localhost:8830 
      (the default user/pass is admin/admin)</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;configuration 
      manager&quot;</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;default 
      configuration&quot;</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;system 
      paths&quot;</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">in the section 
      that says, &quot;extend Dynamo's classpath&quot; enter the full path of 
      the p6 spy jar file, in our example this is: c:\p6spy\p6spy.jar;c:\p6spy</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click the 
      &quot;append to classpath&quot; button</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">confirm the 
      new classpath value is correctly displayed in the extend Dynamo's classpath 
      section</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">restart dynamo 
      (you can do this by going to http://localhost:8830 and using the restart 
      dynamo button at the bottom of the page)</font></li>
    <br>
  </ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change the 
    spy.properties file to reference your database. </b>You must tell P6Spy about 
    your real database driver. The realdriver property is, by default, set to 
    Oracle, such as: realdriver = oracle.jdbc.driver.OracleDriver, change this 
    to reflect your database, if you are using the ATG demo this would be realdriver 
    = solid.jdbc.SolidDriver</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change ATG 
    to use the P6Spy driver<br>
    </b></font> 
    <ul>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> run the 
        admin tool by going to http://localhost:8830</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;configuration 
        manager&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;default 
        configuration&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;connection 
        pools&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;JTDataSource&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;JDBC 
        1.x/2.x driver&quot;<br>
        </font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">select the 
        radio button &quot;custom JDBC information&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">enter the 
        information exactly as you would to connect to your database, except for 
        the driver box, which should be set to com.p6spy.engine.spy.P6SpyDriver</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">if you are 
        using the ATG demonstration, the example setup would be:</font></li>
      <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> <b>URL:</b> 
        jdbc:solid://localhost:1313<br>
        <b>driver:</b> com.p6spy.engine.spy.P6SpyDriver<br>
        <b>database:</b> (blank)<br>
        <b>server:</b> localhost:1313<br>
        <b>server name:</b> (blank)<br>
        <b>user name:</b> admin<br>
        <b>password:</b> admin<br>
        <b>confirm password:</b> admin</font></p>
    </ul>
  </li>
  <ul>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click the 
      &quot;try to connect&quot; button, confirm ATG comes back with a success 
      message (this appears at the top of the page)</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">if ATG comes 
      back with a success message, click the &quot;apply changes&quot; button</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">restart dynamo 
      (you can do this by going to http://localhost:8830 and using the restart 
      dynamo button at the bottom of the page)</font><br>
    </li>
  </ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Run your 
    application and view the logs. </b>By default the spy.log file is written 
    to C:\ATG\Dynamo5.1\home - you can change the location of this file by specifying 
    a location using the property file (see <a href="#property">Property File 
    Settings</a>).</font></li>
</ol>
<p><a name="iplanet"></a><b><font face="Verdana, Arial, Helvetica, sans-serif" size="+1">iPlanet 
  Instructions </font></b> </p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Contributed 
  by Michael Sgroi)</i></font>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">The following 
  procedure has been tested against iPlanet 6.0 service pack 3 as of April 2002. 
  It should work for any release of iPlanet 6.0. </font>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> <b>Unzip the 
    distribution.</b> Unjar the p6spy-install.jar file into a directory, call 
    it &lt;Spy Home&gt;. This contains two files: p6spy.jar and spy.properties.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> <b>Add P6Spy 
    to your classpath.</b> To put the p6spy.jar file in your classpath, run the 
    command line executable &quot;kregedit&quot;. Under Software\iPlanet, 6.0, 
    Java, ClassPath, modify the entry adding &lt;Spy Home&gt; to the end of the 
    classpath.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Configure 
    iPlanet.</b> To tell your application or server to use the P6Spy database 
    driver, run the command line executable &quot;jdbcsetup&quot;. Add a new 3rd 
    Party JDBC Configuration as follows...<br>
    <br>
    Driver Identifier: spy<br>
    Driver Classname: com.p6spy.engine.spy.P6SpyDriver<br>
    Driver Classpath: &lt;Spy Home&gt;\p6spy.jar <br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Configure 
    P6SPy.</b> To tell P6Spy about your real database driver, register your DataSource 
    by running the follwoing command line executable...<br>
    </font> 
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>iasdeploy 
      regdatasource -user &lt;iPlanet admin username&gt; -password &lt;iPlanet 
      admin password&gt; -host localhost -port &lt;iPlanet Admin Port&gt; &lt;Config 
      file name&gt;</i><br>
      <br>
      where the &lt;Config file name&gt; is the full path to the file containing 
      your DataSource configuration. It should look roughly like the following... 
      <br>
      <br>
      &lt;ias-resource&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> &lt;resource&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;jndi-name&gt;jdbc/yourapp/ora-type4-spy&lt;/jndi-name&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;jdbc&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;driver-type&gt;spy&lt;/driver-type&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;database-url&gt;jdbc:oracle:thin:@localhost:1521:orcl&lt;/database-url&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;username&gt;user&lt;/username&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;password&gt;password&lt;/password&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;/jdbc&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;/resource&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;/ias-resource&gt;</font></p>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">For more details 
      parameters passed to iasdeploy and the format of the<br>
      &lt;Config file name&gt; see the iPlanet docs.</font></p>
  </li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="issues"></a>Known 
  Issues </b></font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Non-standard 
    (driver specific) JDBC methods are not supported.&nbsp;&nbsp;</b>Many drivers 
    provide methods that expose driver specific, non-standard functionality. Most 
    developers do not use these features, but in the event that you do, they are 
    not supported by P6Spy. For example, the MySQL JDBC drivers allow you to call 
    the auto-increment function like so: ((org.gjt.mm.mysql.PreparedStatement)stmt).getLastInsertId(); 
    that cast will fail when the P6SpyDriver is in place, since the class it will 
    be trying to cast against is the P6Spy Driver itself, which does not expose 
    that driver specific method. There are ways to get around this limitation, 
    for example by using Dynamic Proxies instead of our current technique. However, 
    these come at a performance cost, that while maybe slight, we have decided 
    to avoid at this time.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="trouble"></a>Troubleshooting</b></font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Application 
    server does not start properly.&nbsp;&nbsp;</b>This is probably because the 
    p6spy.jar file is not in the classpath or the spy.properties file is not in 
    the classpath.&nbsp;&nbsp;In the case of JBoss look at the JBoss log file 
    for clues</font>: 
    <blockquote> 
      <p><font size="2" face="Arial, Helvetica, sans-serif">[JDBC provider] Initializing<br>
        [Service Control] Could not initialize DefaultDomain:service=JdbcProvider</font></p>
    </blockquote>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If you see 
      a message like the above message, that most likely means the jar file cannot 
      be found.&nbsp;&nbsp;Otherwise you may see that the driver is loaded, but 
      the message will say the spy.properties file is not found, and will list 
      all of the directories it looked in for that file. If that is the case, 
      move the spy.properties file to one of the directories listed.</font></p>
  </li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>You see a 
    message stating the spy.properties cannot be found.&nbsp;&nbsp;</b>Often application 
    servers have their own classpath and ignore the standard java classpath. Make 
    sure spy.properties is in the classpath that is listed in the error message 
    stating spy.properties cannot be found, this is the classpath that p6spy is 
    searching. If you still have problems, try using the -Dp6.home option to specify 
    where you have placed the spy.properties file. E.g. java -Dp6.home=c:\orion\lib<br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>The spy.log 
    file is not written.&nbsp;&nbsp;</b>Try searching your entire drive for spy.log, 
    you may find it in a strange place. Remember, you can specify the default 
    location using the spy.properties property file.</font><br>
  </li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>The spy.log 
    file is written, but nothing is being logged.&nbsp; </b>P6Spy has the ability 
    to print debug statements that are very useful in determining why the driver 
    is not working. To turn on these statements, remove the debug category and 
    the info category from the excludecategories list in your spy.options file. 
    Also, a very common mistake is to have your real driver registered elsewhere. 
    To avoid this, set useprefix=true in your spy.properties file and put p6spy: 
    as a prefix for your connection URL for the p6spy driver in your application 
    server configuration. This will cause P6Spy to fail if the prefix is not present 
    and will assure the configuration is as expected.</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">P6Spy was 
    invoked illegally. You probably specified an illegal P6Spy driver in your 
    application configuration. </font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> 
    You most likely got this message because you did not specify com.p6spy.engine.spy.SpyDriver 
    as the driver to register in your application configuration, you specified 
    another class that extends P6SpyDriver, which is illegal.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="faq" id="faq"></a>FAQ</b></font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Can I use 
    regular expressions to determine what is logged?&nbsp;&nbsp;</b>Yes. Please 
    see the <a href="#property">Property</a> section and look at the stringmatcher 
    option.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Once the 
    application is running, can I change the properties and enable the system 
    to use the new properties?&nbsp;&nbsp;</b>Yes. Please see the <a href="#property">Property</a> 
    section and look at the reloadproperties section.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Can I use 
    multiple datasources?&nbsp;&nbsp;</b>Yes. Please see the <a href="#property">Property</a> 
    section and look at the realdriver2, realdriver3 section.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="build" id="faq"></a>Building 
  the Source </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">To build the source 
  you must first <a href="http://www.cacas.org/java/gnu/regexp/">download</a> 
  the GNU RegEx engine and <a href="http://jakarta.apache.org/builds/jakarta-regexp/">download</a> 
  the Jakarta RegEx engine. Copy the RegEx .jar files to the lib/ directory which 
  is a subdirectory of your main directory (the directory with the source code). 
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">You must 
  also <a href="http://jakarta.apache.org/ant/index.html">download</a> and install 
  Jakarta Ant. You then just type ant in the directory with the build.xml file 
  and the code will build. The following are useful targets:</font></p>
<ul>
  <li>[<font face="Verdana, Arial, Helvetica, sans-serif" size="2">no target</font>]<font face="Verdana, Arial, Helvetica, sans-serif" size="2"> 
    creates a p6spy.jar file in the dist/ directory</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">[clean] cleans 
    the directory of build files and tool generated backup files</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">[release] creates 
    the Javadocs, the war file, and all distribution .zip and .jar files</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">[test] runs 
    the standard Junit tests (see notes below)</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">[perform] runs 
    the performance specific JUnit tests (see notes below)</font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">To run the Junit 
  tests, first you must <a href="http://www.junit.org/index.htm">download</a> 
  and install JUnit. Once that is complete you must edit the P6Test.properties 
  file and specify two databases. The configuration is setup for Oracle and MySQL 
  (though you will have to change the Oracle URL at a minimum). You must also 
  copy the vendor database JDBC drivers .jar files of the two databases you use 
  into the lib/ directory.</font></p>
</body>
</html>
