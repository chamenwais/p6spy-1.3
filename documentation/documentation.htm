<html>
<head>
<title>P6Spy Documentation</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="5" color="#000066"><b><a href="http://www.p6spy.com">P6Spy 
  Software</a></b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>Table of Contents</b></font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#license">License 
    agreement</a></font></li>
  <li><a href="#upgrade"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Upgrade 
    instructions</font></a></li>
  <li><a href="#release"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Release 
    Notes <br>
    </font></a></li>
  <li><a href="#install"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">General 
    installation instructions</font></a></li>
  <li><a href="#property"><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Property 
    file settings</font></a></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#log">Log 
    file format</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#jboss">Installation 
    under JBoss</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#orion">Installation 
    under Orion</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#atg">Installation 
    under ATG</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#tomcat">Installation 
    under Tomcat</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#jonas">Installation 
    under JOnAS</a></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#jonas">Installation 
    under WebLogic</a><br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><a href="#trouble">Troubleshooting</a></font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="license"></a>License 
  Agreement</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">/*<br>
  *<br>
  * ====================================================================<br>
  * <br>
  * The P6Spy Software License, Version 1.1<br>
  *<br>
  * This license is derived and fully compatible with the Apache Software<br>
  * license, see http://www.apache.org/LICENSE.txt<br>
  *<br>
  * Copyright (c) 2001-2002 Andy Martin, Ph.D. and Jeff Goke<br>
  * All rights reserved. <br>
  *<br>
  * Redistribution and use in source and binary forms, with or without<br>
  * modification, are permitted provided that the following conditions<br>
  * are met:<br>
  *<br>
  * 1. Redistributions of source code must retain the above copyright<br>
  * notice, this list of conditions and the following disclaimer. <br>
  *<br>
  * 2. Redistributions in binary form must reproduce the above copyright<br>
  * notice, this list of conditions and the following disclaimer in<br>
  * the documentation and/or other materials provided with the<br>
  * distribution.<br>
  *<br>
  * 3. The end-user documentation included with the redistribution, if<br>
  * any, must include the following acknowlegement: <br>
  * &quot;The original concept and code base for P6Spy was conceived<br>
  * and developed by Andy Martin, Ph.D. who generously contribued<br>
  * the first complete release to the public under this license.<br>
  * This product was due to the pioneering work of Andy<br>
  * that began in December of 1995 developing applications that could<br>
  * seamlessly be deployed with minimal effort but with dramatic results.<br>
  * This code is maintained and extended by Jeff Goke and with the ideas<br>
  * and contributions of other P6Spy contributors.<br>
  * (http://www.p6spy.com)&quot;<br>
  * Alternately, this acknowlegement may appear in the software itself,<br>
  * if and wherever such third-party acknowlegements normally appear.<br>
  *<br>
  * 4. The names &quot;P6Spy&quot;, &quot;Jeff Goke&quot;, and &quot;Andy Martin&quot; 
  must not be used<br>
  * to endorse or promote products derived from this software without<br>
  * prior written permission. For written permission, please contact<br>
  * license@p6spy.com.<br>
  *<br>
  * 5. Products derived from this software may not be called &quot;P6Spy&quot;<br>
  * nor may &quot;P6Spy&quot; appear in their names without prior written<br>
  * permission of Jeff Goke and Andy Martin.<br>
  *<br>
  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED<br>
  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES<br>
  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE<br>
  * DISCLAIMED. IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR<br>
  * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,<br>
  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT<br>
  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF<br>
  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND<br>
  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,<br>
  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT<br>
  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF<br>
  * SUCH DAMAGE.<br>
  */ </font></p>
<p></p>
<p><a name="upgrade"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>Upgrade 
  Instructions </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">For those of you 
  who have been using the closed-source version of p6spy, there is only one significant 
  change. In the previous release the package name was &quot;com.p6.engine.spy.P6SpyDriver&quot; 
  in this release it is &quot;com.p6spy.engine.spy.P6SpyDriver&quot;. Notice &quot;com.p6&quot; 
  has been changed to &quot;com.p6spy&quot;. This means a small adjustment to 
  your configuration file. This should not change again.</font></p>
<p><a name="release"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>Release 
  Notes </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Version 0.6</b></font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Fixed a bug 
    that null connections were not returning null, but rather an empty connection. 
    This was a problem for some applications where the application was expecting 
    a null connection.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Added an option 
    to allow the truncation/non-truncation of the log file to be specified within 
    spy.options. </font></li>
</ul>
<p></p>
<p></p>
<p></p>
<p></p>
<p><a name="install"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>General 
  Installation Instructions</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The P6Spy software 
  is very easy to install.&nbsp;&nbsp;There are explicit installation instructions 
  for <a href="#jboss">JBoss</a>, <a href="#orion">Orion</a>, <a href="#atg">ATG</a> 
  and <a href="#tomcat">Tomcat</a>. </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If 
  you create instructions for other servers, please send us a copy and we will 
  include them in the documentation.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put the p6spy.jar 
    file in your classpath.</b> Either copy the p6spy.jar file into your ext direction 
    (if you are using and EJB server it probably has its own ext directory, if 
    you are not, then you probably want to use the JDK ext directory which is 
    JDK_HOME/jre/lib/ext) or add p6spy.jar to your classpath.&nbsp;&nbsp;Remember 
    that if you are adding p6spy.jar to your classpath, you must reference the 
    jar filename directly.&nbsp;&nbsp;In Windows, for example, it might look like: 
    CLASSPATH=c:\p6spy\p6spy.jar.&nbsp;&nbsp;Note that if you are using an EJB 
    server, adding the p6spy.jar file to your classpath may not work.&nbsp;&nbsp;Some 
    EJB servers ignore the classpath and set their own when they start up.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put spy.properties 
    in your classpath.</b> Copy the spy.properties file into a directory listed 
    in your classpath.&nbsp;&nbsp;For example, if your classpath is C:\p6spy\p6spy.jar;c:\java 
    you can copy it to the java directory.&nbsp;&nbsp;Unlike jar files, you do 
    not directly reference your property file in the classpath.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell your 
    application or server to use the P6Spy database driver.</b> Modify your server 
    settings or application settings to tell your application to use P6Spy as 
    your database driver, which is: com.p6spy.engine.spy.P6SpyDriver &nbsp;&nbsp;&nbsp;This 
    does not impact your application, it simply allows P6Spy to read in the database 
    statements before they reach your database driver.&nbsp;&nbsp;Since the P6Spy 
    driver passes through all requests to your real driver, you leave all of the 
    other configuration information, such as the connection address, user, password, 
    etc. the same.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell P6Spy 
    about your real database driver.</b> &nbsp;Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp;&nbsp;For 
    example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Run your 
    application.</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&nbsp;&nbsp;A 
    log file will be generated in the starting directory of your application (you 
    can change this, see the property file section of the documentation).&nbsp;&nbsp;If 
    you can't find the log file, try searching for spy.log</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>View the 
    log file.</b> &nbsp;The log file contains a list of all of the database statements 
    that are executed.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="property"></a>Property 
  File Settings </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Example property 
  file:</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># name of real 
  jdbc driver to load<br>
  realdriver = oracle.jdbc.driver.OracleDriver</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># turn on filtering<br>
  filter = false<br>
  # comma separated list of tables to include<br>
  include =<br>
  # comma separated list of tables to exclude<br>
  exclude =</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># turn on tracing<br>
  trace = true<br>
  autoflush = true<br>
  # name of logfile if trace is on, use &quot;stdout&quot; for standard output.<br>
  logfile = spy.log<br>
  # format of logfile output<br>
  format =</font><br>
  <font face="Verdana, Arial, Helvetica, sans-serif" size="2"># append to the 
  log file (false = truncate)<br>
  append = true</font> <br>
  <font face="Verdana, Arial, Helvetica, sans-serif" size="2"># print debug statements, 
  particularly log the registration of the driver<br>
  debug = true</font> <br>
  <br>
</p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>realdriver</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">realdriver is where 
  you specify the real database driver that you use.&nbsp;&nbsp;P6Spy wraps around 
  your existing driver, intercepts the incoming database requests, and outputs 
  them to a log file.&nbsp;&nbsp;To achieve this without requiring any code changes, 
  the P6Spy driver is listed with your application as the primary driver.&nbsp;&nbsp;P6Spy 
  then intercepts and logs the requests, and passes the request to the realdriver 
  where it is processed as usual.&nbsp;&nbsp;Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">realdriver = oracle.jdbc.driver.OracleDriver</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>filter, include, 
  exclude </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">P6Spy lets you 
  monitor specific tables or specific statement types.&nbsp;&nbsp;By setting filter=true 
  the application will apply the filters specified n the include and exclude options 
  against the query to determine if that query should be written to the log file.&nbsp;&nbsp;include 
  accepts a comma separated list of statements or tables to include in the log, 
  exclude accepts a comma separated list to exclude.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">example (capture 
  all select statements except the orders table):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = true<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># comma separated 
  list of tables to include<br>
  include = select<br>
  # comma separated list of tables to exclude<br>
  exclude = orders</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">example (only captures 
  statements against order,order_details,price, and price_history):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = true<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># comma separated 
  list of tables to include<br>
  include = order,order_details,price,price_history<br>
  # comma separated list of tables to exclude<br>
  exclude =</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">example (captures 
  all statements except statements against the order table):</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">filter = false<br>
  </font><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># comma separated 
  list of tables to include<br>
  include = <br>
  # comma separated list of tables to exclude<br>
  exclude = order</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>trace</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Trace is a convenience 
  toggle that lets you turn on and off the logging.&nbsp;&nbsp;When trace is set 
  to true, P6Spy writes the the log file whenever an appropriate database request 
  is intercepted. &nbsp;When trace is set to false, P6Spy never writes to the 
  log file.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"># turn</font><font face="Verdana, Arial, Helvetica, sans-serif" size="2">on 
  tracing<br>
  trace = true</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>autoflush</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">For standard development 
  this value should be set to true. &nbsp;When set to true every time a statement 
  is intercepted it is immediately written to the log file.&nbsp;&nbsp;In some 
  cases, however, instant feedback on every statement is not a requirement, and 
  the system will perform slightly faster with this value set to false</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">autoflush = true<br>
  </font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>logfile</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Specifies the name 
  of the file to generate.&nbsp;&nbsp;Use &quot;stdout&quot; for standard output. 
  Note, if you are in Windows and are specifying a pathname, make sure to use 
  forward slashes (e.g. c:/mylog/spy.log)</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">logfile = spy.log<br>
  </font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>append</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Setting append=true 
  causes p6spy to continue to append to the logfile, if it exists. Setting append=false 
  causes the logfile to be truncated each time p6spy is restarted (typically when 
  your application or application server is restarted).</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>debug</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Prints debug statements. 
  Useful in debugging the status of P6Spy if output is not being written to the 
  log. In particular, this will cause a statement to be written to the defined 
  log file when the driver is registered and it will output all of the property 
  file settings.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>dateformat</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Setting a value 
  for dateformat changes the date format value printed in the log file. No value 
  prints the current time in milliseconds, a useful feature for parsing the log. 
  The date format engine is Java's SimpleDateFormat class. See the SimpleDateFormat 
  class in the JavaDocs for information on setting this value. Example value: 
  dateformat=MM-dd-yy HH:mm:ss:SS</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Command Line 
  Options </b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Every parameter 
  specified in the property file can be set and override at the command line using 
  the Java -D flag.</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Example:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">java -Dp6logfile=my.log 
  -Dp6trace=true</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">In addition, you 
  can set the default directory to look for spy.properties:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">java -Dp6.home=c:\orion\lib</font></p>
<p><a name="log"></a><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b>Log 
  File Format</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">The log file format 
  of spy.log is as follows:</font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">current time|statement 
  SQL String|effective SQL string</font></p>
<ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Current time</i>. 
    The current time is obtained through System.getCurrentTimeMillis() and represents 
    the number of milliseconds that have passed since January 1, 1970 00:00:00.000 
    GMT. See the J2SE documentation for further details.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Statement 
    SQL String</i>. This is the SQL string passed to the statement object. If 
    it is a prepared statement, it will be the prepared statement prior to the 
    parameters being set, to see the complete statement see <i>Effective SQL String</i>.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><i>Effective 
    SQL String</i>. If you are not using a prepared statement, this will be empty. 
    Otherwise it will fill in the values of the Prepared Statement so you can 
    see the effective SQL statement that is passed to the Database. Of course 
    the Database still sees the Prepared Statement, but this string allows a convenient 
    way to see the actual values being based to the Database.</font></li>
</ul>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="jboss"></a>JBoss 
  Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with Jboss 2.2.2 with Tomcat 3.2.2 integration.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put the p6spy.jar 
    file in your ext directory.</b> For example: C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\lib\ext</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put spy.properties 
    in your db directory (which is part of the JBoss classpath).</b> For example: 
    C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\db</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell JBoss 
    to use the P6Spy driver. </b>&nbsp;Modify the jboss.jcml file to use the P6 
    driver.&nbsp;&nbsp;Make sure to modify the correct file. In the case of the 
    integrated tomcat solution, you should modify the jboss.jcml file in the Tomcat 
    directory. You should remove your existing driver from the drivers attribute 
    and replace that driver with the P6Spy driver. This looks like:</font> </li>
  <blockquote> 
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;mbean code=&quot;org.jboss.jdbc.JdbcProvider&quot; 
      name=&quot;DefaultDomain:service=JdbcProvider&quot;&gt;<br>
      &lt;attribute name=&quot;Drivers&quot;&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/attribute&gt;<br>
      &lt;/mbean&gt;</font></p>
  </blockquote>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell P6Spy 
    about your real database driver.</b> &nbsp;Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp;&nbsp;For 
    example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Installation 
    is complete.&nbsp;&nbsp;</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">There 
    is nothing else to change. You leave your connect string, username, password 
    and other attributes exactly as they were before you installed P6Spy, the 
    P6Spy driver does all of the work required to pass this information along 
    to your real database driver.</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Run your 
    application.</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&nbsp;&nbsp;A 
    spy.log file will be generated in the bin directory of the JBoss server such 
    as: C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\bin </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>View the 
    log file.</b> &nbsp;The log file contains a list of all of the database statements 
    that are executed.</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="orion"></a>Orion 
  Installation</b></font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Put p6spy.jar 
    and spy.properties in your [orion-home]\lib directory.</b> For example: c:\orion\lib</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell Orion 
    to use the P6Spy driver. </b>&nbsp;Modify [orion-home]\config\data-sources.xml 
    to use the P6 driver.&nbsp;&nbsp;In the data-sources.xml file change connection-driver 
    to specify the p6spy driver instead of the database driver you are using. 
    For example:</font> </li>
  <blockquote> 
    <p> <font face="Verdana, Arial, Helvetica, sans-serif" size="2">&lt;data-source<br>
      class=&quot;com.evermind.sql.DriverManagerDataSource&quot;<br>
      name=&quot;Hypersonic&quot;<br>
      location=&quot;jdbc/HypersonicCoreDS&quot;<br>
      xa-location=&quot;jdbc/xa/HypersonicXADS&quot;<br>
      ejb-location=&quot;jdbc/HypersonicDS&quot;<br>
      connection-driver=&quot;com.p6spy.engine.spy.P6SpyDriver&quot;<br>
      username=&quot;sa&quot;<br>
      password=&quot;&quot;<br>
      url=&quot;jdbc:HypersonicSQL:./database/defaultdb&quot;<br>
      inactivity-timeout=&quot;30&quot;<br>
      /&gt;</font></p>
  </blockquote>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell P6Spy 
    about your real database driver.</b> &nbsp;Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp;&nbsp;This 
    is the value that was previously specified in connection-driver before you 
    changed it in step 3. For example, if you were using Hypersonic (the default 
    database) this would be: realdriver = org.hsql.jdbcDriver</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Installation 
    is complete.&nbsp;&nbsp;</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">There 
    is nothing else to change. You leave your connect string, username, password 
    and other attributes exactly as they were before you installed P6Spy, the 
    P6Spy driver does all of the work required to pass this information along 
    to your real database driver.</font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">Run your 
    application.</font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="2">&nbsp;&nbsp;In 
    the example installation, Orion will not be able to find spy.properties because 
    of the classpath that Orion uses. The easiest way to overcome this is to use 
    the -D option to tell Orion where the property file resides. For example, 
    run Orion using java -Dp6.home=c:\orion\orion\lib -jar orion.jar<br>
    <br>
    A spy.log file will be generated in the [orion-home] directory. If for some 
    reason the file does not appear in that directory, search for spy.log on your 
    drive. You can change the location of this file by specifying a location using 
    the property file (see <a href="#property">Property File Settings</a>).<br>
    <br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>View the 
    log file.</b> &nbsp;The log file contains a list of all of the database statements 
    that are executed.<br>
    </font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="atg"></a>ATG 
  Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with ATG Dynamo 5.1.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties. Copy them to a directory. For this 
    example, we will copy both files to c:\p6spy</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Start the 
    ATG Dynamo server.</b> Start the ATG application server and your database.</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change the 
    ATG Dynamo server to include both files in the classpath.</b></font></li>
  <ul>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">run the admin 
      tool (in this example we will assume you are running ATG on your own machine, 
      so we will use localhost as the machine name), go to http://localhost:8830 
      (the default user/pass is admin/admin)</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;configuration 
      manager&quot;</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;default 
      configuration&quot;</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;system 
      paths&quot;</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">in the section 
      that says, &quot;extend Dynamo's classpath&quot; enter the full path of 
      the p6 spy jar file, in our example this is: c:\p6spy\p6spy.jar;c:\p6spy</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click the 
      &quot;append to classpath&quot; button</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">confirm the 
      new classpath value is correctly displayed in the extend Dynamo's classpath 
      section</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">restart dynamo 
      (you can do this by going to http://localhost:8830 and using the restart 
      dynamo button at the bottom of the page)</font></li>
    <br>
    <br>
  </ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change the 
    spy.properties file to reference your database. </b>You must tell P6Spy about 
    your real database driver. The realdriver property is, by default, set to 
    Oracle, such as: realdriver = oracle.jdbc.driver.OracleDriver, change this 
    to reflect your database, if you are using the ATG demo this would be realdriver 
    = solid.jdbc.SolidDriver</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change ATG 
    to use the P6Spy driver<br>
    </b></font> 
    <ul>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> run the 
        admin tool by going to http://localhost:8830</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;configuration 
        manager&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;default 
        configuration&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;connection 
        pools&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;JTDataSource&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click &quot;JDBC 
        1.x/2.x driver&quot;<br>
        </font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">select the 
        radio button &quot;custom JDBC information&quot;</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">enter the 
        information exactly as you would to connect to your database, except for 
        the driver box, which should be set to com.p6spy.engine.spy.P6SpyDriver</font></li>
      <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">if you are 
        using the ATG demonstration, the example setup would be:</font></li>
      <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2"> <b>URL:</b> 
        jdbc:solid://localhost:1313<br>
        <b>driver:</b> com.p6spy.engine.spy.P6SpyDriver<br>
        <b>database:</b> (blank)<br>
        <b>server:</b> localhost:1313<br>
        <b>server name:</b> (blank)<br>
        <b>user name:</b> admin<br>
        <b>password:</b> admin<br>
        <b>confirm password:</b> admin</font></p>
    </ul>
  </li>
  <ul>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">click the 
      &quot;try to connect&quot; button, confirm ATG comes back with a success 
      message (this appears at the top of the page)</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">if ATG comes 
      back with a success message, click the &quot;apply changes&quot; button</font></li>
    <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2">restart dynamo 
      (you can do this by going to http://localhost:8830 and using the restart 
      dynamo button at the bottom of the page)</font><br>
      <br>
    </li>
  </ul>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Run your 
    application and view the logs. </b>By default the spy.log file is written 
    to C:\ATG\Dynamo5.1\home - you can change the location of this file by specifying 
    a location using the property file (see <a href="#property">Property File 
    Settings</a>).</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="tomcat"></a>Tomcat 
  Installation</b></font></p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">These instructions 
  have been tested with Tomcat 3.x.&nbsp;&nbsp;Please note that since you typically 
  write or otherwise obtain your own connection pool when using Tomcat, these 
  instructions will differ by application.</font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp;&nbsp;This contains 
    two files: p6spy.jar and spy.properties. Copy them to the lib\ directory of 
    your web application. For example: C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\lib</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Tell your 
    Tomcat application to use P6Spy as the database driver. </b> Tomcat applications 
    obtain their JDBC connection in a variety of ways. Most applications have 
    the database driver name externalized as a configuration parameter. For example, 
    in your web.xml file (C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\web.xml) 
    you may have something like this:<br>
    <br>
    &lt;init-param&gt;&lt;param-name&gt;databaseDriver&lt;/param-name&gt;&lt;param-value&gt;org.gjt.mm.mysql.Driver&lt;/param-value&gt;&lt;/init-param&gt;<br>
    <br>
    In this case the &quot;databaseDriver&quot; parameter has a value of &quot;org.gjt.mm.mysql.Driver&quot;, 
    which is the MySQL driver. Wherever this configuration information is stored, 
    you need to change the driver name (&quot;org.gjt.mm.mysql.Driver&quot; in 
    our example) to com.p6spy.engine.spy.P6SpyDriver such as:<br>
    <br>
    &lt;init-param&gt;&lt;param-name&gt;databaseDriver&lt;/param-name&gt;&lt;param-value&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/param-value&gt;&lt;/init-param&gt;<br>
    <br>
    </font> <br>
  </li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Enable Tomcat 
    to find spy.properties. </b>While all of the .jar files in your webapps lib 
    directory are, by default, included in Tomcat's classpath, the lib directory 
    itself is not, which means Tomcat will not be able to find your spy.properties 
    file, which will cause an error to occur. All this means is that you have 
    to include spy.properties in the Tomcat classpath. The simplest way to do 
    this is to use the TOMCAT_OPTS environment variable to specify the location 
    of the spy.properties file. For example:<br>
    <br>
    SET TOMCAT_OPTS=-Dp6.home=C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\lib<br>
    <br>
    </font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Change the 
    spy.properties file to reference your database. </b>You must tell P6Spy about 
    your real database driver. The realdriver property is, by default, set to 
    Oracle, such as: realdriver = oracle.jdbc.driver.OracleDriver, change this 
    to reflect your database. In our previous example, where we were using MySQL, 
    this would be changed to: realdriver = org.gjt.mm.mysql.Driver</font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Run your 
    application and view the logs. </b>By default the spy.log file is written 
    to the place you start Tomcat, such as C:\jakarta-tomcat-3.2.1\bin - you can 
    change the location of this file by specifying a location using the property 
    file (see <a href="#property">Property File Settings</a>).</font></li>
</ol>
<p><a name="jonas"></a><b><font face="Verdana, Arial, Helvetica, sans-serif" size="+1">JOnAS 
  Installation</font></b> 
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">These instructions 
  have been tested with JOnAS 2.3.x. </font><br>
  <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Contributed 
  by François Exertier, JOnAS Opensource EJB Server team)</i> </font> 
<ol>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp; This contains two 
    files: p6spy.jar and spy.properties</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Put the 
    p6spy.jar file in the classpath of the JOnAS EJB server.</b> For example, 
    if p6spy.jar is in the /opt/Provider6 directory, you may add /opt/Provider6/p6psy.jar 
    to the XTRA_CLASSPATH environment variable (or directly edit the config_env 
    script)</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Put spy.properties 
    in a directory which is part of your classpath.</b> The best may be to put 
    it in the same directory as your jndi.properties file</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Tell JOnAS 
    to use the P6Spy database driver.&nbsp;</b> Database access configuration 
    within JOnAS is described in a DataSource property file, e.g. Oracle1.properties 
    (see the JOnAS Bean Programmer's Guide for more details). Modify the &lt;datasource>.properties 
    file by replacing the database driver classname by the P6Psy database driver 
    class name in the datasource.classname property. For example the Oracle1.properties 
    file delivered with JOnAS should be updated by replacing oracle.jdbc.driver.OracleDriver 
    by com.p6spy.engine.spy.P6SpyDriver, it then looks like</font></li>
  <blockquote><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.name&nbsp;&nbsp; 
    jdbc_1</font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.description&nbsp; 
    "Standard jdbc driver for Oracle"</font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.url&nbsp;&nbsp; 
    jdbc:oracle:thin:scott/tiger@maltes:1521:ORA1</font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">datasource.classname 
    <b>com.p6spy.engine.spy.P6SpyDriver</b></font> <br>
    <font face="Verdana, Arial, Helvetica, sans-serif" size="-1">...</font></blockquote>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Tell P6Spy 
    about your real database driver.</b>&nbsp; Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp; 
    In our example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Installation 
    is complete.&nbsp; </b>There is nothing else to change. You leave your other 
    datasource properties, e.g. name, url, username, password and so on exactly 
    as they were before you installed P6Spy, the P6Spy driver does all of the 
    work required to pass this information along to your real database driver</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Run your 
    application.</b>&nbsp; Run EJBServer. A spy.log file will be generated in 
    the launching directory</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>View the 
    log file.</b>&nbsp; The log file contains a list of all of the database statements 
    that are executed. You can change the location of this file and the nature 
    of its content by using the spy property file (see <a href="#property">Property 
    File Settings</a>)</font><br>
  </li>
</ol>
<p><a name="weblogic"></a><b><font face="Verdana, Arial, Helvetica, sans-serif" size="+1">WebLogic 
  Instructions </font></b> </p>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">These instructions 
  have been tested with WebLogic 5.1</font><br>
  <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><i>(Posted by Richard 
  Delbert on April 10, 2002 on TheServerSide.com)</i> </font> <br>

<ol>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Unzip the 
    distribution. </b>Unjar the p6spy-install.jar file.&nbsp; This contains two 
    files: p6spy.jar and spy.properties</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Edit startWeblogic.sh, 
    put the p6spy.jar file in the JAVA_CLASSPATH.</b></font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Edit startWeblogic.sh, 
    put spy.properties in the JAVA_CLASSPATH.</b></font></li>
  <li><b><font face="Verdana, Arial, Helvetica, sans-serif" size="-1">Edit weblogic.properties 
    (connection pool). </font></b><font face="Verdana, Arial, Helvetica, sans-serif" size="-1"> 
    Replace the JDBC class driver with com.p6spy.engine.spy.P6SpyDriver.</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Tell P6Spy 
    about your real database driver.</b>&nbsp; Modify the spy.properties file 
    and change the realdriver line to reflect your real database driver.&nbsp; 
    In our example: realdriver = oracle.jdbc.driver.OracleDriver</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Installation 
    is complete.</b></font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>Run your 
    application.</b>&nbsp; A spy.log file will be created in the weblogic home 
    directory.</font></li>
  <li> <font face="Verdana, Arial, Helvetica, sans-serif" size="-1"><b>View the 
    log file.</b>&nbsp; The log file contains a list of all of the database statements 
    that are executed. You can change the location of this file and the nature 
    of its content by using the spy property file (see <a href="#property">Property 
    File Settings</a>)</font></li>
</ol>
<p><font face="Verdana, Arial, Helvetica, sans-serif" size="4"><b><a name="trouble"></a>Troubleshooting</b></font></p>
<ol>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>Application 
    server does not start properly.&nbsp;&nbsp;</b>This is probably because the 
    p6spy.jar file is not in the classpath or the spy.properties file is not in 
    the classpath.&nbsp;&nbsp;In the case of JBoss look at the JBoss log file 
    for clues</font>: 
    <blockquote> 
      <p><font size="2" face="Arial, Helvetica, sans-serif">[JDBC provider] Initializing<br>
        [Service Control] Could not initialize DefaultDomain:service=JdbcProvider</font></p>
    </blockquote>
    <p><font face="Verdana, Arial, Helvetica, sans-serif" size="2">If you see 
      a message like the above message, that most likely means the jar file cannot 
      be found.&nbsp;&nbsp;Otherwise you may see that the driver is loaded, but 
      the message will say the spy.properties file is not found, and will list 
      all of the directories it looked in for that file. If that is the case, 
      move the spy.properties file to one of the directories listed.</font></p>
  </li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>You see a 
    message stating the spy.properties cannot be found.&nbsp;&nbsp;</b>Often application 
    servers have their own classpath and ignore the standard java classpath. Make 
    sure spy.properties is in the classpath that is listed in the error message 
    stating spy.properties cannot be found, this is the classpath that p6spy is 
    searching. If you still have problems, try using the -Dp6.home option to specify 
    where you have placed the spy.properties file. E.g. java -Dp6.home=c:\orion\lib<br><br></font></li>
  <li><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>The spy.log 
    file is not written.&nbsp;&nbsp;</b>First, try searching your entire drive 
    for spy.log, you may find it in a strange place. Remember, you can specify 
    the default location using the spy.properties property file. Next, set debug=true 
    in spy.properties and try restarting the system. This will output a line when 
    the driver initializes and will output the properties being used in spy.log, 
    look for anything that is incorrect in this information.</font></li>
</ol>
</body>
</html>
